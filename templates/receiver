#!/bin/bash
set -eo pipefail

repository=$1
app=${1%.git}
sha=$2
username=$3
fingerprint=$4

URL=http://{{ .deis_controller_host }}:{{ .deis_controller_port }}/api/apps/$app/push

curl -v \
  -X 'POST' --fail \
  -H 'Content-Type: application/json' \
  -H "X-Deis-Builder-Auth: $BUILDER_KEY" \
  -d "{\"receive_user\": \"$username\", \"receive_repo\": \"$app\", \"sha\": \"$sha\", \"fingerprint\": \"$fingerprint\", \"ssh_connection\": \"$SSH_CONNECTION\", \"ssh_original_command\": \"$SSH_ORIGINAL_COMMAND\"}" \
  --silent $URL >/dev/null
  